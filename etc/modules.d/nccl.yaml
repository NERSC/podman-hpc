name: nccl
cli_arg: nccl
help: Enable special ss11 plugin for NCCL
env: ENABLE_NCCL
additional_args:
  - -e LD_LIBRARY_PATH=/opt/udiImage/modules/nccl-2.15/lib:/opt/udiImage/modules/nccl-2.15/deps/lib
  - -e FI_CXI_DISABLE_HOST_REGISTER=1
  - -e NCCL_CROSS_NIC=1
  - -e NCCL_SOCKET_IFNAME=hsn
  - -e CCL_NET_GDR_LEVEL=PHB
  - -e NCCL_NET="AWS Libfabric"
copy:
  - ../01-nccl.conf:/etc/ld.so.conf.d/01-nccl.conf
  - /global/common/software/nersc/pm-2022q4/sw/evp-patch/lib64/libcrypto.so*:/opt/udiImage/modules/nccl-2.15/deps/lib/*
  - /global/common/software/nersc/pm-2022q4/sw/evp-patch/lib64/libssh.so*:/opt/udiImage/modules/nccl-2.15/deps/lib/*
  - /global/common/software/nersc/pm-2022q4/sw/evp-patch/lib64/libssl.so*:/opt/udiImage/modules/nccl-2.15/deps/lib/*
  - /global/common/software/nersc/pm-2022q4/sw/nccl-2.15.5-ofi-r4/lib/*:/opt/udiImage/modules/nccl-2.15/lib/*
  - /global/common/software/nersc/pm-2022q4/sw/nccl-2.15.5-ofi-r4/include/*:/opt/udiImage/modules/nccl-2.15/include/*
bind:    
  - /usr/lib64/libcxi.so*:/usr/lib64/libcxi.so*
  - /usr/lib64/libcurl.so*:usr/lib64/libcurl.so*
  - /usr/lib64/libjson-c.so*:/usr/lib64/libjson-c.so*
  - /opt/cray/pe/gcc/11.2.0/snos/lib64/libatomic.so*:/opt/cray/pe/gcc/11.2.0/snos/lib64/libatomic.so*
  - /opt/cray/libfabric/1.15.2.0/lib64/libfabric.so*:/opt/cray/libfabric/1.15.2.0/lib64/libfabric.so*
  - /opt/cray/pe/mpich/8.1.22/gtl/lib/libmpi_gtl_cuda.so*:/opt/cray/pe/mpich/8.1.22/gtl/lib/libmpi_gtl_cuda.so*
  - /opt/cray/xpmem/default/lib64/libxpmem.so*:/opt/cray/xpmem/default/lib64/libxpmem.so*
  - /usr/lib64/libnghttp2.so*:/usr/lib64/libnghttp2.so*
  - /usr/lib64/libidn2.so*:/usr/lib64/libidn2.so*
  - /usr/lib64/libpsl.so*:/usr/lib64/libpsl.so*
  - /usr/lib64/libgssapi_krb5.so*:/usr/lib64/libgssapi_krb5.so*
  - /usr/lib64/libldap_r-2.4.so*:/usr/lib64/libldap_r-2.4.so*
  - /usr/lib64/liblber-2.4.so*:/usr/lib64/liblber-2.4.so*
  - /usr/lib64/libunistring.so*:/usr/lib64/libunistring.so*
  - /usr/lib64/libkrb5.so*:usr/lib64/libkrb5.so*
  - /usr/lib64/libk5crypto.so*:/usr/lib64/libk5crypto.so*
  - /usr/lib64/libcom_err.so*:/usr/lib64/libcom_err.so*
  - /usr/lib64/libkrb5support.so*:/usr/lib64/libkrb5support.so*
  - /lib64/libresolv.so*:/lib64/libresolv.so*
  - /usr/lib64/libsasl2.so*:/usr/lib64/libsasl2.so*
  - /usr/lib64/libkeyutils.so*:/usr/lib64/libkeyutils.so*
